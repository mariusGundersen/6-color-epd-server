<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bilderamme</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="manifest" href="/manifest.json">
  <script src="https://unpkg.com/htmx.org@2.0.4"
    integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
    crossorigin="anonymous"></script>
  <script>
    function isBefore(el1, el2) {
      if (el2.parentNode !== el1.parentNode) return false;
      for (var cur = el1.previousSibling; cur && cur.nodeType !== 9; cur = cur.previousSibling) {
        if (cur === el2)
          return true;
      }
      return false;
    }

    let _el;
    htmx.onLoad(function (content) {
      if (content.matches('li.draggable')) {
        const elm = content;
        elm.addEventListener('dragover', e => {
          if (isBefore(_el, e.currentTarget))
            e.currentTarget.parentNode.insertBefore(_el, e.currentTarget);
          else
            e.currentTarget.parentNode.insertBefore(_el, e.currentTarget.nextSibling);
        }, false);

        elm.addEventListener('dragstart', e => {
          e.dataTransfer.effectAllowed = "move";
          e.dataTransfer.setData("text/plain", null); // Thanks to bqlou for their comment.
          _el = e.currentTarget;
        }, false);
      }
    });
  </script>
</head>

<body>
  <div class="timeline">
    <ul hx-get="/api/photos/list" hx-swap="beforeend" hx-trigger="load">
      <li>
        <label>
          <input type="file" accept="image/*" />
          <span>Nytt bilde</span>
        </label>
      </li>
    </ul>
  </div>
  <dialog>
    <pan-zoom></pan-zoom>
    <form method="dialog">
      <button formmethod="dialog">CANCEL</button>
      <button type="submit">OK</button>
    </form>
  </dialog>
  <script type="module" src="/main.js"></script>
</body>

</html>